
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "examples/auto_basic_example/subgallery_beam/ex_basics_fmi.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_examples_auto_basic_example_subgallery_beam_ex_basics_fmi.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_examples_auto_basic_example_subgallery_beam_ex_basics_fmi.py:


Run simulations with low-level functions
----------------------------------------

.. GENERATED FROM PYTHON SOURCE LINES 8-10

Prerequisites
#############

.. GENERATED FROM PYTHON SOURCE LINES 12-13

First, load the following libraries :

.. GENERATED FROM PYTHON SOURCE LINES 13-18

.. code-block:: Python

    import otfmi.example.utility
    import pyfmi
    import openturns as ot
    import matplotlib.pyplot as plt








.. GENERATED FROM PYTHON SOURCE LINES 19-21

Load the model
##############

.. GENERATED FROM PYTHON SOURCE LINES 23-26

First, retrieve the path to the example FMU *deviation.fmu*.
Then, load the fmu with the `load_fmu` method.


.. GENERATED FROM PYTHON SOURCE LINES 26-30

.. code-block:: Python


    path_fmu = otfmi.example.utility.get_path_fmu("deviation")
    model = otfmi.fmi.load_fmu(path_fmu)








.. GENERATED FROM PYTHON SOURCE LINES 31-33

You can load your model by enforcing CoSimulation kind and specifying the filename for the
logs writing:

.. GENERATED FROM PYTHON SOURCE LINES 33-35

.. code-block:: Python

    model = otfmi.fmi.load_fmu(path_fmu, kind="CS", log_file_name="deviation.log")








.. GENERATED FROM PYTHON SOURCE LINES 36-41

.. note::
  If the FMU is both ModelExchange and CoSimulation, the CoSimulation type is
  favoured.
  This choice, **opposite to PyFMI's default**, enables the CoSimulation
  to impose a solver not available in PyFMI.

.. GENERATED FROM PYTHON SOURCE LINES 43-45

The link betwen otfmi and pyfmi
###############################

.. GENERATED FROM PYTHON SOURCE LINES 47-50

OTFMI `load_fmu` is an overlay of PyFMI `load_fmu` function.
Hence the FMU loaded here upper benefits of all PyFMI's methods.
You can get the list of options of `pyfmi.load_fmu` by typing :

.. GENERATED FROM PYTHON SOURCE LINES 50-53

.. code-block:: Python


    print(help(pyfmi.load_fmu))





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Help on method descriptor load_fmu in module pyfmi.fmi:

    load_fmu(
        fmu,
        log_file_name='',
        kind='auto',
        log_level=2,
        allow_unzipped_fmu=False
    )
        Helper method for creating a model instance.

        Parameters::

            fmu --
                Name of the fmu as a string.

            log_file_name --
                Filename for file used to save log messages.
                This argument can also be a stream if it supports 'write', for full functionality
                it must also support 'seek' and 'readlines'. If the stream requires use of other methods, such as 'drain'
                for asyncio-streams, then this needs to be implemented on the user-side, there is no additional methods invoked
                on the stream instance after 'write' has been invoked on the PyFMI side.
                The stream must also be open and writable during the entire time.
                Default: "" (Generates automatically)

            kind --
                String indicating the kind of model to create. This is only
                needed if a FMU contains multiple models.
                Available options:
                    - 'ME'
                    - 'CS'
                    - 'SE'
                    - 'auto'
                Default: 'auto' (Chooses ME > CS > SE, if multiple are available)

            log_level --
                Determines the logging output. Can be set between 0
                (no logging) and 7 (everything).
                Default: 2 (log error messages)
            allow_unzipped_fmu --
                If set to True, the argument 'fmu' can be a path specifying a directory
                to an unzipped FMU. The structure of the unzipped FMU must conform
                to the FMI specification.
                Default: False

        Returns::

            A model instance corresponding to the loaded FMU.

    None




.. GENERATED FROM PYTHON SOURCE LINES 54-55

For example, ``get_description`` is a PyFMI method :

.. GENERATED FROM PYTHON SOURCE LINES 55-57

.. code-block:: Python

    model.get_description()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    'Model from here: http://doc.openturns.org/openturns-latest/html/ExamplesGuide/cid1.xhtml#cid1'



.. GENERATED FROM PYTHON SOURCE LINES 58-60

FMU exploration
###############

.. GENERATED FROM PYTHON SOURCE LINES 62-68

Knowledge about the FMU is necessary to setup a simulations.

- What is the name of each variable ?
- Which are the inputs, outputs, parameters ?
- Which are booleans, reals, integers ?
- What is their default start value ?

.. GENERATED FROM PYTHON SOURCE LINES 70-72

You can get the FMU variables names with the ``get_name_variable`` method.
This shows all variables : inputs, parameters, outputs.

.. GENERATED FROM PYTHON SOURCE LINES 72-76

.. code-block:: Python


    list_name = otfmi.fmi.get_name_variable(model)
    print(list_name)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    ['E', 'F', 'I', 'L', 'y']




.. GENERATED FROM PYTHON SOURCE LINES 77-78

You need to identify their causality in the model:

.. GENERATED FROM PYTHON SOURCE LINES 78-83

.. code-block:: Python


    for name in list_name:
        causality = otfmi.fmi.get_causality_str(model, name)
        print(f"{name}: {causality}")





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    E: INPUT
    F: INPUT
    I: INPUT
    L: INPUT
    y: OUTPUT




.. GENERATED FROM PYTHON SOURCE LINES 84-86

| Yet the variables type is not known: real, integer, boolean, string?
| Let check using `PyFMI's method <http://shorturl.at/dJ157>`_:

.. GENERATED FROM PYTHON SOURCE LINES 86-91

.. code-block:: Python


    for name in list_name:
        typ = model.get_variable_data_type(name)
        print(f"{name}: {typ}")





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    E: 0
    F: 0
    I: 0
    L: 0
    y: 0




.. GENERATED FROM PYTHON SOURCE LINES 92-94

| The type `0` corresponds to `Real` (aka "float") variables.
| Let check the variables default start value in the FMU:

.. GENERATED FROM PYTHON SOURCE LINES 94-98

.. code-block:: Python


    dict_start_value = otfmi.fmi.get_start_value(model)
    print(dict_start_value)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    {'E': 30000000.0, 'F': 30000.0, 'I': 400.0, 'L': 250.0}




.. GENERATED FROM PYTHON SOURCE LINES 99-102

.. note::
   Function `otfmi.fmi.get_start_value` only returns the start value of
   variables with types Real, Integer or Boolean.

.. GENERATED FROM PYTHON SOURCE LINES 104-106

With this knowledge on the FMU variables, we can now simulate it (with
non-default initialization values if required).

.. GENERATED FROM PYTHON SOURCE LINES 109-111

Run a simulation
################

.. GENERATED FROM PYTHON SOURCE LINES 113-115

The otfmi ``simulate`` function instanciates, initializes and simulates the
FMU.

.. GENERATED FROM PYTHON SOURCE LINES 115-126

.. code-block:: Python


    # Here, we define a simulation with our `model`, from time 0 to 1s,
    # and we initialize the beam's length `L` at 300:
    result = otfmi.fmi.simulate(
        model,
        start_time=0,  # PyFMI keyword
        final_time=1,  # PyFMI keyword
        initialization_parameters=(["L"], [300]),  # otfmi keyword
    )
    print("y = %g" % result.final("y"))





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Simulation interval    : 0 - 1.0 seconds.
    Elapsed simulation time: 0.01923946899978546 seconds.
    y = 22.5




.. GENERATED FROM PYTHON SOURCE LINES 127-131

.. note::
   The *model* is a PyFMI object, loaded with otfmi’s overlay.
   As such, ``model.simulate()`` is a pure PyFMI method.
   Use ``otfmi.fmi.simulate(model)`` to benefit from otfmi’s overlay.

.. GENERATED FROM PYTHON SOURCE LINES 134-137

At this stage, simulations are ready to be executed.
We use OpenTURNS to generate a set of simulations, by sampling the initial
value of the the beam's length `L` with 10 different values from 1 to 100.

.. GENERATED FROM PYTHON SOURCE LINES 137-149

.. code-block:: Python


    inputSample = ot.RegularGrid(1.0, 10.0, 10).getValues()

    list_output = []
    for length in inputSample:
        result = otfmi.fmi.simulate(
            model,
            initialization_parameters=(["L"], [length]))
        list_output.append(result.final("y"))

    outputSample = ot.Sample([[xx] for xx in list_output])





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Simulation interval    : 0.0 - 1.0 seconds.
    Elapsed simulation time: 0.019385895000141318 seconds.
    Simulation interval    : 0.0 - 1.0 seconds.
    Elapsed simulation time: 0.02299535400015884 seconds.
    Simulation interval    : 0.0 - 1.0 seconds.
    Elapsed simulation time: 0.03019373100005396 seconds.
    Simulation interval    : 0.0 - 1.0 seconds.
    Elapsed simulation time: 0.028764506000243273 seconds.
    Simulation interval    : 0.0 - 1.0 seconds.
    Elapsed simulation time: 0.019190032000096835 seconds.
    Simulation interval    : 0.0 - 1.0 seconds.
    Elapsed simulation time: 0.02013101700003972 seconds.
    Simulation interval    : 0.0 - 1.0 seconds.
    Elapsed simulation time: 0.020165666000139026 seconds.
    Simulation interval    : 0.0 - 1.0 seconds.
    Elapsed simulation time: 0.019926227999803814 seconds.
    Simulation interval    : 0.0 - 1.0 seconds.
    Elapsed simulation time: 0.020197586999984196 seconds.
    Simulation interval    : 0.0 - 1.0 seconds.
    Elapsed simulation time: 0.019400948000111384 seconds.




.. GENERATED FROM PYTHON SOURCE LINES 150-151

Finally, we use matplotlib to plot the results

.. GENERATED FROM PYTHON SOURCE LINES 151-158

.. code-block:: Python


    plt.figure()
    plt.plot(inputSample, outputSample)
    plt.xlabel("Initial value of the beam's length.")
    plt.ylabel("Deviation.")
    plt.show()




.. image-sg:: /examples/auto_basic_example/subgallery_beam/images/sphx_glr_ex_basics_fmi_001.png
   :alt: ex basics fmi
   :srcset: /examples/auto_basic_example/subgallery_beam/images/sphx_glr_ex_basics_fmi_001.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 159-161

Conclusion
################

.. GENERATED FROM PYTHON SOURCE LINES 163-170

You have just seen how to run several simulations, by tuning just one parameter.
OTFMI provides higher-level functions to :

- avoid the *for* loop on the points of the design of experiment,
- automatic formatting of the simulation outputs.

The next example shows you a shorter and easier way to run a set of simulations.


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 0.449 seconds)


.. _sphx_glr_download_examples_auto_basic_example_subgallery_beam_ex_basics_fmi.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: ex_basics_fmi.ipynb <ex_basics_fmi.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: ex_basics_fmi.py <ex_basics_fmi.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: ex_basics_fmi.zip <ex_basics_fmi.zip>`
